"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),bySellerRequest=require("../validation/turnover_by_seller"),byStoreRequest=require("../validation/turnover_by_store"),_require=require("../middlware/errorHandler"),ForbiddenError=_require.ForbiddenError,_require2=require("../enums/modules"),modules=_require2.modules,turnoverStatsService=require("../services/turnoverStats"),getValidatorMiddleware=require("../middlware/validator"),byStoreMethod=function(){var a=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function a(b,c,d){var e,f;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,b.abilities.getModules().includes(modules.StatsModule);case 2:if(a.sent){a.next=4;break}return a.abrupt("return",d(new ForbiddenError));case 4:return a.next=6,b.abilities.getStores();case 6:return e=a.sent.map(function(a){return a.id}),a.next=9,turnoverStatsService.byStore(e,b.validated.search);case 9:f=a.sent,c.send(f);case 11:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}(),byStore=[getValidatorMiddleware(byStoreRequest),byStoreMethod],bySellerMethod=function(){var a=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function a(b,c,d){var e,f,g,h;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,b.abilities.getModules().includes(modules.StatsModule);case 2:if(a.sent){a.next=4;break}return a.abrupt("return",d(new ForbiddenError));case 4:return e=b.validated.storeId,a.next=7,b.abilities.getStores();case 7:if(f=a.sent.map(function(a){return a.id}),f.includes(e)){a.next=10;break}return a.abrupt("return",d(new ForbiddenError));case 10:return a.next=12,turnoverStatsService.byStore([e]);case 12:return g=a.sent[0],a.next=15,turnoverStatsService.bySeller([e]);case 15:h=a.sent,c.send({store:g,sellers:h});case 17:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}(),bySeller=[getValidatorMiddleware(bySellerRequest),bySellerMethod];module.exports={byStore:byStore,bySeller:bySeller};