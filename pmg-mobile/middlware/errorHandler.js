"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_wrapNativeSuper2=_interopRequireDefault(require("@babel/runtime/helpers/wrapNativeSuper"));function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=(0,_getPrototypeOf2["default"])(a);if(b){var e=(0,_getPrototypeOf2["default"])(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return(0,_possibleConstructorReturn2["default"])(this,c)}}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}var _=require("lodash"),CaslForbiddenError=require("@casl/ability").ForbiddenError,config=require("../config/config"),d_error=require("../lib/debug").d_error;config.debug&&exposeErrorPropertiesForDebugPurpose(!0);var errorHandler=function(a,b,c,d){return a instanceof ServerError||(d_error("guessing error %O",a),a=guessError(a)),c.headersSent?d(a):config.debug?(d_error("parsed error %O",a),c.status(a.status).send(_.pick(a,["name","message","details","previous_debug_use_only"]))):c.status(a.status).send(_.pick(a,["name","message","details"]))};function guessError(a){return a instanceof CaslForbiddenError?new ForbiddenError("",a):new ServerError("",a)}var ServerError=function(a){function b(a,d){var e;return(0,_classCallCheck2["default"])(this,b),e=c.call(this,a||"Server error"),e.name=e.constructor.name,e.status=500,e.previous_debug_use_only=d,e}(0,_inherits2["default"])(b,a);var c=_createSuper(b);return b}((0,_wrapNativeSuper2["default"])(Error)),DatabaseError=function(a){function b(a,d){var e;return(0,_classCallCheck2["default"])(this,b),e=c.call(this,a||"Database error",d),e.status=500,e}(0,_inherits2["default"])(b,a);var c=_createSuper(b);return b}(ServerError),BadRequestError=function(a){function b(a,d){var e;return(0,_classCallCheck2["default"])(this,b),e=c.call(this,a||"Bad request"),e.status=400,e.tag=d,e}(0,_inherits2["default"])(b,a);var c=_createSuper(b);return b}(ServerError),UnauthorizedError=function(a){function b(a){var d;return(0,_classCallCheck2["default"])(this,b),d=c.call(this,a||"Unauthorized access"),d.status=401,d}(0,_inherits2["default"])(b,a);var c=_createSuper(b);return b}(ServerError),ForbiddenError=function(a){function b(a,d){var e;return(0,_classCallCheck2["default"])(this,b),e=c.call(this,a||"Vous n'avez pas access \xE0 cette ressource",d),e.status=403,e}(0,_inherits2["default"])(b,a);var c=_createSuper(b);return b}(ServerError),NotFoundError=function(a){function b(a){var d;return(0,_classCallCheck2["default"])(this,b),d=c.call(this,a||"Resource not found"),d.status=404,d}(0,_inherits2["default"])(b,a);var c=_createSuper(b);return b}(ServerError),ValidationError=function(a){function b(a,d){var e;return(0,_classCallCheck2["default"])(this,b),e=c.call(this,"ValidationError",d||a),e.status=422,e.details=a.details.map(function(a){return _.pick(a,["message","path"])}),e}(0,_inherits2["default"])(b,a);var c=_createSuper(b);return b}(ServerError);function exposeErrorPropertiesForDebugPurpose(a){"toJSON"in Error.prototype||Object.defineProperty(Error.prototype,"toJSON",{value:function value(){var b={};return Object.getOwnPropertyNames(this).forEach(function(c){a&&"stack"===c||(b[c]=this[c])},this),b},configurable:!0,writable:!0})}module.exports={errorHandler:errorHandler,ServerError:ServerError,DatabaseError:DatabaseError,BadRequestError:BadRequestError,UnauthorizedError:UnauthorizedError,ForbiddenError:ForbiddenError,NotFoundError:NotFoundError,ValidationError:ValidationError};