"use strict";var usersService=require("../services/usersService"),jwt=require("../lib/jwt"),config=require("../config/config"),d_auth=require("../lib/debug").d_auth,token_header="x-access-token",set_token_header="x-set-access-token";function jwtVerifyMiddleware(a,b,c){var d=a.get(token_header);if(d)try{a.decoded=jwt.verify(d),d_auth("Verified token %s",d)}catch(a){config.debug&&d_auth("Invalid token")}c()}function jwtSignMiddleware(a,b,c){if(!a.user)return c();var d=jwt.sign({id:a.user.id});b.set(set_token_header,d),d_auth("Next token %s",d),c()}module.exports={verify:jwtVerifyMiddleware,next:jwtSignMiddleware,token_header:token_header,set_token_header:set_token_header};