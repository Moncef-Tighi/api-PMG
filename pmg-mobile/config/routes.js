"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),AuthController=require("../controllers/auth"),ArticlesController=require("../controllers/articles"),FeedbacksController=require("../controllers/feedbacks"),UsersController=require("../controllers/users"),ReportsController=require("../controllers/reports"),StoresController=require("../controllers/stores"),TurnoverStatsController=require("../controllers/turnoverStats"),moment=require("moment"),router=require("express").Router(),_require=require("../middlware/jwt"),token_header=_require.token_header,set_token_header=_require.set_token_header,_require2=require("../services/storesService"),getAllStores=_require2.getAllStores;require("express-async-errors");var _require3=require("../lib/db"),remoteDb=_require3.remoteDb,_require4=require("../middlware/auth"),Auth=_require4.Auth;router.get("/",[function(){var a=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function a(b,c){var d;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,remoteDb("ARTICLE").select({date:"GA_DATEMODIF"}).where("GA_ARTICLE","ART001                           X");case 2:return d=a.sent,a.t0=c,a.t1=d,a.t2=moment().format("YYYY-MM-DD HH:mm:ss"),a.t3=b.get(token_header),a.t4=c.get(set_token_header),a.t5=b.decoded,a.t6=b.user,a.t7=b.abilities?b.abilities.name:null,a.t8=b.abilities?b.abilities.getModules():[],a.next=14,getAllStores();case 14:a.t9=a.sent,a.t10={tarif:a.t1,time:a.t2,token:a.t3,next_token:a.t4,tokenData:a.t5,user:a.t6,role:a.t7,modules:a.t8,stores:a.t9},a.t0.send.call(a.t0,a.t10);case 17:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}()]),router.post("/auth/login",AuthController.login),router.get("/auth/profile",[Auth,AuthController.profile]),router.put("/auth/update-password",[Auth,AuthController.updatePassword]),router.get("/articles/get",[Auth,ArticlesController.show]),router.get("/articles",[Auth,ArticlesController.index]),router.get("/feedbacks",[Auth,FeedbacksController.index]),router.post("/feedbacks",[Auth,FeedbacksController.store]),router.put("/feedbacks/:id(\\d+)",[Auth,FeedbacksController.update]),router["delete"]("/feedbacks/:id(\\d+)",[Auth,FeedbacksController.destroy]),router.get("/reports",[Auth,ReportsController.index]),router.post("/reports",[Auth,ReportsController.store]),router.put("/reports/:id(\\d+)",[Auth,ReportsController.update]),router.get("/reports/types",[Auth,ReportsController.getTypes]),router.get("/users",[Auth,UsersController.index]),router.put("/users/:id(\\d+)",[Auth,UsersController.update]),router.post("/users/import/:cegidId",[Auth,UsersController.import_]),router.get("/users/my-sellers",[Auth,UsersController.mySellers]),router.post("/users/authorize",[Auth,UsersController.authorize]),router.get("/stats/turnover/by-store",[Auth,TurnoverStatsController.byStore]),router.get("/stats/turnover/by-seller",[Auth,TurnoverStatsController.bySeller]),router.get("/stores",[Auth,StoresController.index]),module.exports=router;