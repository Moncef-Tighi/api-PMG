"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_wrapNativeSuper2=_interopRequireDefault(require("@babel/runtime/helpers/wrapNativeSuper"));function _createSuper(f){var a=_isNativeReflectConstruct();return function(){var b,g=(0,_getPrototypeOf2["default"])(f);if(a){var d=(0,_getPrototypeOf2["default"])(this).constructor;b=Reflect.construct(g,arguments,d)}else b=g.apply(this,arguments);return(0,_possibleConstructorReturn2["default"])(this,b)}}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(b){return!1}}var _=require("lodash"),CaslForbiddenError=require("@casl/ability").ForbiddenError,config=require("../config/config"),d_error=require("../lib/debug").d_error;config.debug&&exposeErrorPropertiesForDebugPurpose(!0);var errorHandler=function(e,f,b,c){return e instanceof ServerError||(d_error("guessing error %O",e),e=guessError(e)),b.headersSent?c(e):config.debug?(d_error("parsed error %O",e),b.status(e.status).send(_.pick(e,["name","message","details","previous_debug_use_only"]))):b.status(e.status).send(_.pick(e,["name","message","details"]))};function guessError(b){return b instanceof CaslForbiddenError?new ForbiddenError("",b):new ServerError("",b)}var ServerError=function(d){function f(c,a){var d;return(0,_classCallCheck2["default"])(this,f),d=b.call(this,c||"Server error"),d.name=d.constructor.name,d.status=500,d.previous_debug_use_only=a,d}(0,_inherits2["default"])(f,d);var b=_createSuper(f);return f}((0,_wrapNativeSuper2["default"])(Error)),DatabaseError=function(d){function f(c,a){var d;return(0,_classCallCheck2["default"])(this,f),d=b.call(this,c||"Database error",a),d.status=500,d}(0,_inherits2["default"])(f,d);var b=_createSuper(f);return f}(ServerError),BadRequestError=function(d){function f(c,a){var d;return(0,_classCallCheck2["default"])(this,f),d=b.call(this,c||"Bad request"),d.status=400,d.tag=a,d}(0,_inherits2["default"])(f,d);var b=_createSuper(f);return f}(ServerError),UnauthorizedError=function(d){function e(c){var a;return(0,_classCallCheck2["default"])(this,e),a=b.call(this,c||"Unauthorized access"),a.status=401,a}(0,_inherits2["default"])(e,d);var b=_createSuper(e);return e}(ServerError),ForbiddenError=function(d){function f(c,a){var d;return(0,_classCallCheck2["default"])(this,f),d=b.call(this,c||"Vous n'avez pas access \xE0 cette ressource",a),d.status=403,d}(0,_inherits2["default"])(f,d);var b=_createSuper(f);return f}(ServerError),NotFoundError=function(d){function e(c){var a;return(0,_classCallCheck2["default"])(this,e),a=b.call(this,c||"Resource not found"),a.status=404,a}(0,_inherits2["default"])(e,d);var b=_createSuper(e);return e}(ServerError),ValidationError=function(d){function f(c,a){var d;return(0,_classCallCheck2["default"])(this,f),d=b.call(this,"ValidationError",a||c),d.status=422,d.details=c.details.map(function(b){return _.pick(b,["message","path"])}),d}(0,_inherits2["default"])(f,d);var b=_createSuper(f);return f}(ServerError);function exposeErrorPropertiesForDebugPurpose(d){"toJSON"in Error.prototype||Object.defineProperty(Error.prototype,"toJSON",{value:function(){var a={};return Object.getOwnPropertyNames(this).forEach(function(b){d&&"stack"===b||(a[b]=this[b])},this),a},configurable:!0,writable:!0})}module.exports={errorHandler:errorHandler,ServerError:ServerError,DatabaseError:DatabaseError,BadRequestError:BadRequestError,UnauthorizedError:UnauthorizedError,ForbiddenError:ForbiddenError,NotFoundError:NotFoundError,ValidationError:ValidationError};