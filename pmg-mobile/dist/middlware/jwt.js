"use strict";var usersService=require("../services/usersService"),jwt=require("../lib/jwt"),config=require("../config/config"),d_auth=require("../lib/debug").d_auth,token_header="x-access-token",set_token_header="x-set-access-token";function jwtVerifyMiddleware(e,a,b){var c=e.get(token_header);if(c)try{e.decoded=jwt.verify(c),d_auth("Verified token %s",c)}catch(b){config.debug&&d_auth("Invalid token")}b()}function jwtSignMiddleware(e,a,b){if(!e.user)return b();var c=jwt.sign({id:e.user.id});a.set(set_token_header,c),d_auth("Next token %s",c),b()}module.exports={verify:jwtVerifyMiddleware,next:jwtSignMiddleware,token_header:"x-access-token",set_token_header:"x-set-access-token"};