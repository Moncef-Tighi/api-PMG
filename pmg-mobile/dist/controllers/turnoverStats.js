"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),bySellerRequest=require("../validation/turnover_by_seller"),_require=require("../middlware/errorHandler"),ForbiddenError=_require.ForbiddenError,_require2=require("../enums/modules"),modules=_require2.modules,turnoverStatsService=require("../services/turnoverStats"),getValidatorMiddleware=require("../middlware/validator"),byStore=function(){var b=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function g(h,b,c){var d,i;return _regenerator["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.abilities.getModules().includes(modules.StatsModule);case 2:if(e.sent){e.next=4;break}return e.abrupt("return",c(new ForbiddenError));case 4:return e.next=6,h.abilities.getStores();case 6:return d=e.sent.map(function(b){return b.id}),e.next=9,turnoverStatsService.byStore(d);case 9:i=e.sent,b.send(i);case 11:case"end":return e.stop();}},g)}));return function(){return b.apply(this,arguments)}}(),bySellerMethod=function(){var b=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function h(i,b,c){var d,j,k;return _regenerator["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.abilities.getModules().includes(modules.StatsModule);case 2:if(e.sent){e.next=4;break}return e.abrupt("return",c(new ForbiddenError));case 4:return d=i.validated.storeId,e.next=7,i.abilities.getStores();case 7:if(j=e.sent.map(function(b){return b.id}),j.includes(d)){e.next=10;break}return e.abrupt("return",c(new ForbiddenError));case 10:return e.next=12,turnoverStatsService.bySeller([d]);case 12:k=e.sent,b.send(k);case 14:case"end":return e.stop();}},h)}));return function(){return b.apply(this,arguments)}}(),bySeller=[getValidatorMiddleware(bySellerRequest),bySellerMethod];module.exports={byStore:byStore,bySeller:bySeller};