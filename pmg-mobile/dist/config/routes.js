"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),AuthController=require("../controllers/auth"),ArticlesController=require("../controllers/articles"),FeedbacksController=require("../controllers/feedbacks"),UsersController=require("../controllers/users"),ReportsController=require("../controllers/reports"),StoresController=require("../controllers/stores"),TurnoverStatsController=require("../controllers/turnoverStats"),moment=require("moment"),router=require("express").Router(),_require=require("../middlware/jwt"),token_header=_require.token_header,set_token_header=_require.set_token_header,_require2=require("../services/storesService"),getAllStores=_require2.getAllStores;require("express-async-errors");var _require3=require("../lib/db"),remoteDb=_require3.remoteDb,_require4=require("../middlware/auth"),Auth=_require4.Auth;router.get("/",[function(){var b=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function e(f,b){var c;return _regenerator["default"].wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,remoteDb("ARTICLE").select({date:"GA_DATEMODIF"}).where("GA_ARTICLE","ART001                           X");case 2:return c=d.sent,d.t0=b,d.t1=c,d.t2=moment().format("YYYY-MM-DD HH:mm:ss"),d.t3=f.get(token_header),d.t4=b.get(set_token_header),d.t5=f.decoded,d.t6=f.user,d.t7=f.abilities?f.abilities.name:null,d.t8=f.abilities?f.abilities.getModules():[],d.next=14,getAllStores();case 14:d.t9=d.sent,d.t10={tarif:d.t1,time:d.t2,token:d.t3,next_token:d.t4,tokenData:d.t5,user:d.t6,role:d.t7,modules:d.t8,stores:d.t9},d.t0.send.call(d.t0,d.t10);case 17:case"end":return d.stop();}},e)}));return function(){return b.apply(this,arguments)}}()]),router.post("/auth/login",AuthController.login),router.get("/auth/profile",[Auth,AuthController.profile]),router.put("/auth/update-password",[Auth,AuthController.updatePassword]),router.get("/articles/get",[Auth,ArticlesController.show]),router.get("/articles",[Auth,ArticlesController.index]),router.get("/feedbacks",[Auth,FeedbacksController.index]),router.post("/feedbacks",[Auth,FeedbacksController.store]),router.put("/feedbacks/:id(\\d+)",[Auth,FeedbacksController.update]),router["delete"]("/feedbacks/:id(\\d+)",[Auth,FeedbacksController.destroy]),router.get("/reports",[Auth,ReportsController.index]),router.post("/reports",[Auth,ReportsController.store]),router.put("/reports/:id(\\d+)",[Auth,ReportsController.update]),router.get("/reports/types",[Auth,ReportsController.getTypes]),router.get("/users",[Auth,UsersController.index]),router.put("/users/:id(\\d+)",[Auth,UsersController.update]),router.post("/users/import/:cegidId",[Auth,UsersController.import_]),router.get("/users/my-sellers",[Auth,UsersController.mySellers]),router.post("/users/authorize",[Auth,UsersController.authorize]),router.get("/stats/turnover/by-store",[Auth,TurnoverStatsController.byStore]),router.get("/stats/turnover/by-seller",[Auth,TurnoverStatsController.bySeller]),router.get("/stores",[Auth,StoresController.index]),module.exports=router;