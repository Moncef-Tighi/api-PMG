"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));function ownKeys(e,a){var b=Object.keys(e);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);a&&(c=c.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),b.push.apply(b,c)}return b}function _objectSpread(d){for(var a,e=1;e<arguments.length;e++)a=null==arguments[e]?{}:arguments[e],e%2?ownKeys(Object(a),!0).forEach(function(b){(0,_defineProperty2["default"])(d,b,a[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach(function(b){Object.defineProperty(d,b,Object.getOwnPropertyDescriptor(a,b))});return d}function _createForOfIteratorHelper(i,j){var b="undefined"!=typeof Symbol&&i[Symbol.iterator]||i["@@iterator"];if(!b){if(Array.isArray(i)||(b=_unsupportedIterableToArray(i))||j&&i&&"number"==typeof i.length){b&&(i=b);var k=0,l=function(){};return{s:l,n:function(){return k>=i.length?{done:!0}:{done:!1,value:i[k++]}},e:function(b){throw b},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var e,m=!0,n=!1;return{s:function(){b=b.call(i)},n:function(){var c=b.next();return m=c.done,c},e:function(b){n=!0,e=b},f:function a(){try{m||null==b["return"]||b["return"]()}finally{if(n)throw a}}}}function _unsupportedIterableToArray(d,a){if(d){if("string"==typeof d)return _arrayLikeToArray(d,a);var b=Object.prototype.toString.call(d).slice(8,-1);return"Object"===b&&d.constructor&&(b=d.constructor.name),"Map"===b||"Set"===b?Array.from(d):"Arguments"===b||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(b)?_arrayLikeToArray(d,a):void 0}}function _arrayLikeToArray(e,a){(null==a||a>e.length)&&(a=e.length);for(var f=0,g=Array(a);f<a;f++)g[f]=e[f];return g}var abilitiesDefinition=require("../config/abilities"),requiredProperties=["getModules","getStores","restrictFeedbacksQuery","canManageFeedbacks","canManageUsers","canManageReports"];function getAbilitiesFor(g){var a=getDefinitionFor(g.cegidRole,!0);if(!a)throw new Error("Definition pour le role \"".concat(g.cegidRole,"\" introuvable"));var b,h=a.getInstance(g),d=_createForOfIteratorHelper(requiredProperties);try{for(d.s();!(b=d.n()).done;){var e=b.value;if(!h.hasOwnProperty(e))throw new Error("Role incomplet ".concat(g.cegidRole))}}catch(b){d.e(b)}finally{d.f()}return _objectSpread(_objectSpread({},h),{},{definition:_objectSpread(_objectSpread({},a),{},{getInstance:void 0})})}function getDefinitionFor(f,a){var b,g=_createForOfIteratorHelper(abilitiesDefinition);try{for(g.s();!(b=g.n()).done;){var d=b.value;if(d.cegidRole&&d.cegidRole===f)return a?d:_objectSpread(_objectSpread({},d),{},{getInstance:void 0})}}catch(b){g.e(b)}finally{g.f()}}function getManagedCegidRoles(){var e,f=[],b=_createForOfIteratorHelper(abilitiesDefinition);try{for(b.s();!(e=b.n()).done;){var c=e.value;c.cegidRole&&f.push(c.cegidRole)}}catch(c){b.e(c)}finally{b.f()}return f}function canHandleCegidRole(b){return getManagedCegidRoles().includes(b)}module.exports={getAbilitiesFor:getAbilitiesFor,getDefinitionFor:getDefinitionFor,getManagedCegidRoles:getManagedCegidRoles,canHandleCegidRole:canHandleCegidRole};